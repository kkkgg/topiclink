
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Topiclink</title>
    <script type="text/javascript">
      function getRec(list, topicid){
        return list.find(function(rec){
          return rec[0] == topicid;
        });
      }

      fetch("topics.txt").then(function(response){
        return response.text();
      }).then(function(text){
        //console.log(text);
        return text.split("\n").map(l => l.split("\t"));
      }).then(function(list){
        console.log(list);
        var l = window.location;
        var topicid = (l.pathname.match(/[^/]+$/) || [])[0];
        if(topicid == "404.html") topicid = (l.hash.match(/[^#]+$/) || [])[0];
        console.log({topicid: topicid});
        var rec = getRec(list, topicid);
        console.log(rec);
        if(rec){
          var url = rec[1];
          console.log({redirect_to: url});
          if(url.match(/^file:/)){
            alert(url + "\n" * topicid);
          } else{
            l.replace(url + "#" + topicid);
          }
        }
      });


    </script>
  </head>
  <body>
    topiclink redirector
  </body>
</html>
